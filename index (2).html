<!-- ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ ÐºÐ»Ð¸ÐµÐ½Ñ‚ Socket.io -->
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<script>
    const socket = io('https://snula.github.io/mafia-servers/'); // Ð¡ÑÑ‹Ð»ÐºÐ° Ð½Ð° Ñ‚Ð²Ð¾Ð¹ ÑÐµÑ€Ð²ÐµÑ€
    const tg = window.Telegram.WebApp;
    const userName = tg.initDataUnsafe?.user?.first_name || "Ð˜Ð³Ñ€Ð¾Ðº";

    let myRole = "";
    let allPlayers = [];

    // ÐŸÑ€Ð¸ Ð²Ñ…Ð¾Ð´Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ð¸Ð¼Ñ ÑÐµÑ€Ð²ÐµÑ€Ñƒ
    socket.emit('joinGame', userName);

    // ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¿Ð¸ÑÐºÐ° Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² Ð¾Ñ‚ ÑÐµÑ€Ð²ÐµÑ€Ð°
    socket.on('updatePlayers', (serverPlayers) => {
        allPlayers = serverPlayers;
        renderPlayers();
    });

    // ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ñ€Ð¾Ð»Ð¸
    socket.on('getRole', (role) => {
        myRole = role;
        document.getElementById('roleDisplay').textContent = "Ð’Ð°ÑˆÐ° Ñ€Ð¾Ð»ÑŒ: " + role;
        document.getElementById('roleDisplay').style.color = (role === 'ÐœÐ°Ñ„Ð¸Ñ') ? 'red' : 'cyan';
    });

    socket.on('gameStarted', (players) => {
        showScreen('game');
        allPlayers = players;
        renderPlayers();
    });

    socket.on('playerKilled', (data) => {
        alert(`Ð˜Ð³Ñ€Ð¾Ðº ${data.name} Ð¿Ð¾ÐºÐ¸Ð½ÑƒÐ» Ð½Ð°Ñ...`);
    });

    function renderPlayers() {
        const container = document.getElementById('playerContainer');
        container.innerHTML = '';

        allPlayers.forEach((p) => {
            const card = document.createElement('div');
            card.className = `player-card ${!p.isAlive ? 'dead' : ''}`;
            card.innerHTML = `<div>ðŸ‘¤</div><div>${p.name}</div>`;

            // Ð•ÑÐ»Ð¸ Ð¼Ñ‹ Ð¶Ð¸Ð²Ñ‹ Ð¸ ÑÑ‚Ð¾ Ð½Ðµ Ð¼Ñ‹ ÑÐ°Ð¼Ð¸, Ð¼Ð¾Ð¶Ð½Ð¾ Ð½Ð°Ð¶Ð°Ñ‚ÑŒ
            if (p.isAlive && p.id !== socket.id) {
                card.onclick = () => sendAction(p.id);
            }
            container.appendChild(card);
        });
    }

    function startGame() {
        socket.emit('startGame');
    }

    function sendAction(targetId) {
        socket.emit('action', targetId);
    }

    function showScreen(id) {
        document.querySelectorAll('.container > div').forEach(div => div.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
</script>